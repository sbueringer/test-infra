var __generator=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function u(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},__values=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}},__read=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};!function(){"use strict";function t(t){return"string"==typeof t.type}var e=function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},n=new(function(){function n(){var t=this;this.pendingRequests=new Map,this.messageId=0,this.pendingUpdateTimer=0,this.currentHash="",this.currentHash=location.hash,this.observer=new MutationObserver(function(e){return t.handleMutations(e)}),window.addEventListener("message",function(e){return t.handleMessage(e)}),window.addEventListener("hashchange",function(e){return t.handleHashChange(e)}),window.addEventListener("DOMContentLoaded",function(){t.fixAnchorLinks(document.documentElement),t.observer.observe(document.documentElement,{attributeFilter:["href"],childList:!0,subtree:!0})}),window.addEventListener("load",function(){t.contentUpdated(),setTimeout(function(){""!==location.hash&&t.tryMoveToHash(location.hash)},100)})}return n.prototype.updatePage=function(t){return e(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.postMessage({type:"updatePage",data:t})];case 1:return e.sent(),this.contentUpdated(),[2]}})})},n.prototype.requestPage=function(t){return e(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.postMessage({type:"requestPage",data:t})];case 1:return[2,e.sent().data]}})})},n.prototype.request=function(t){return e(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.postMessage({type:"request",data:t})];case 1:return[2,e.sent().data]}})})},n.prototype.contentUpdated=function(){var t=this;this.updateHeight(),clearTimeout(this.pendingUpdateTimer),this.pendingUpdateTimer=setTimeout(function(){return t.updateHeight()},0)},n.prototype.makeFragmentLink=function(t){var e,n=function r(t){var e,n,r={};try{for(var o=__values(t.split("&").map(function(t){return t.split("=").map(unescape)})),i=o.next();!i.done;i=o.next()){var a=__read(i.value,2);r[a[0]]=a[1]}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}(location.search.substr(1));return"#"!==t[0]&&(t="#"+t),n.topURL+"#"+function o(t){return Object.keys(t).map(function(e){return e+":"+escape(t[e].substr(1))}).join(";")}(((e={})[n.lensIndex]=t,e))},n.prototype.scrollTo=function(t,n){return e(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.postMessage({type:"showOffset",left:t,top:n})];case 1:return e.sent(),[2]}})})},n.prototype.updateHeight=function(){this.postMessage({type:"contentUpdated",height:document.body.offsetHeight}).then()},n.prototype.postMessage=function(t){var e=this;return new Promise(function(n,r){var o=++e.messageId;e.pendingRequests.set(o,n),window.parent.postMessage({id:o,message:t},document.location.origin)})},n.prototype.handleMessage=function(e){if(e.origin===document.location.origin){var n=e.data;!function r(t){return"number"==typeof t.id&&t.message&&"string"==typeof t.message.type}(n)?function o(e){return t(e)&&"updateHash"===e.type}(n)&&(location.hash=n.hash):function i(e){return t(e)&&"response"===e.type}(n.message)&&this.pendingRequests.has(n.id)&&(this.pendingRequests.get(n.id)(n.message),this.pendingRequests.delete(n.id))}else console.warn("Got MessageEvent from unexpected origin "+e.origin+"; expected "+document.location.origin,e)},n.prototype.handleMutations=function(t){var e,n;try{for(var r=__values(t),o=r.next();!o.done;o=r.next()){var i=o.value;if(i.target instanceof HTMLElement)if("childList"===i.type)this.fixAnchorLinks(i.target);else if("attributes"===i.type&&i.target instanceof HTMLAnchorElement&&"href"===i.attributeName){var a=i.target.getAttribute("href");a&&"#"===a[0]&&this.fixAnchorLink(i.target)}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},n.prototype.handleHashChange=function(t){location.hash!==this.currentHash&&(this.currentHash=location.hash,this.postMessage({type:"updateHash",hash:location.hash}).then(),this.tryMoveToHash(location.hash))},n.prototype.tryMoveToHash=function(t){t=t.substr(1);var e=document.getElementById(t);if(e||(e=document.getElementsByName(t)[0])){var n=e.getBoundingClientRect().top+window.pageYOffset;this.scrollTo(0,n).then()}},n.prototype.fixAnchorLinks=function(t){var e,n;try{for(var r=__values(Array.from(t.querySelectorAll('a[href^="#"]'))),o=r.next();!o.done;o=r.next())this.fixAnchorLink(o.value)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},n.prototype.fixAnchorLink=function(t){t.href=location.href.split("#")[0]+t.getAttribute("href"),t.target="_self"},n}());window.spyglass=n}();